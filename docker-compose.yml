### Required setup for the build images.
# tmpfs and /sys/fs/cgroup volumes are needed for systemd to work properly
# /mnt/build is where the git repositories will be shared with the host
version: '3.8'
services:
  deb_build:
    container_name: deb-build
    privileged: true
    build:
      context: .
      dockerfile: Dockerfile
      args:
        OSimage: "$OSimage"
        ARCH: "$ARCH"
        REPO: "$REPO"
        useproxy: "${useproxy:-no}"
        proxy: "$proxy"
    image: build.$REPO/$OSimage.$ARCH
    tmpfs:
      - /run
      - /tmp
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
      - ../:/mnt/build

