# Docker compose file dedicated to Unibuild builds
version: '3.9'

###
# Some repeated defaults:
# tmpfs and /sys/fs/cgroup volumes are needed for systemd to work properly
# /app is where the git repositories will be shared with the host
###
x-tmpfs:
  &default-tmpfs
  - /run
  - /run/lock
  - /tmp

x-volumes:
  &default-volumes
  - ${DIR_TO_BE_BUILT}:/app
 
services:
  alma8:
    image: ghcr.io/perfsonar/unibuild/alma8:latest
    volumes: *default-volumes
  alma9:
    image: ghcr.io/perfsonar/unibuild/alma9:latest
    volumes: *default-volumes
  centos7:
    image: ghcr.io/perfsonar/unibuild/centos7:latest
    volumes: *default-volumes
  d10_amd64:
    platform: "linux/amd64"
    image: ghcr.io/perfsonar/unibuild/d10:latest@sha256:1389da7bc7bbfe4ac1ca36d265c7dea62328136abb1a49c7c6adda7fdea735b2
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  d10_arm64:
    platform: "linux/arm64"
    image: ghcr.io/perfsonar/unibuild/d10:latest@sha256:393eda4a96af9cc57d530a5d4d03976a079955f5f48ac0a40eec6879ac945cad
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  d10_armv7:
    platform: "linux/arm/v7"
    image: ghcr.io/perfsonar/unibuild/d10:latest@sha256:4207221a173f645b6e35440ad0e0b21ca4e1e6102aec0d706fedfd1c015cabc6
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  d10_ppc64le:
    platform: "linux/ppc64le"
    image: ghcr.io/perfsonar/unibuild/d10:latest@sha256:d9538b9d18899422b1153b4769a22d15720e4d54e2c7ae6f06af06807ba3763b
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  u18_amd64:
    platform: "linux/amd64"
    image: ghcr.io/perfsonar/unibuild/u18:debian-tarball@sha256:24672ba37a256f0c9b9fa8520102c6cc0ea93c29a9c1e7880fd5f23a9afb93ad
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  u18_arm64:
    platform: "linux/arm64"
    image: ghcr.io/perfsonar/unibuild/u18:debian-tarball@sha256:1d691c7f850ce432b4a0ed842f071ffe54102648bb902d58c498a72cb2377076
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  u18_armv7:
    platform: "linux/arm/v7"
    image: ghcr.io/perfsonar/unibuild/u18:debian-tarball@sha256:90b6019448dbf70f12e295b72f8cb0dbb5555962c950fdac5c8b7e738487a4a4
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  u18_ppc64le:
    platform: "linux/ppc64le"
    image: ghcr.io/perfsonar/unibuild/u18:debian-tarball@sha256:fb6fbab5f7cc79b4315c3130e19fc6a804ce5b3d0a695c0d72856c890e4e4d70
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  u20_amd64:
    platform: "linux/amd64"
    image: ghcr.io/perfsonar/unibuild/u20:latest@sha256:567cf33a88522f43bcd83cb8c217503e6aca44e773822d54c7ac2bad6128c1c0
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  u20_arm64:
    platform: "linux/arm64"
    image: ghcr.io/perfsonar/unibuild/u20:latest@sha256:76d8d30700171aed5234ebb5b1e81539fb261657664d5fb24b0613b27b0a1a20
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  u20_armv7:
    platform: "linux/arm/v7"
    image: ghcr.io/perfsonar/unibuild/u20:latest@sha256:bf92f8bbbb38465ad7a3a766a35e8d5fc893eaa0e3ba8c90191355c30417f8c2
    command: bash -c "sleep infinity"
    volumes: *default-volumes
  u20_ppc64le:
    platform: "linux/ppc64le"
    image: ghcr.io/perfsonar/unibuild/u20:latest@sha256:507c546f66e272a7e63441046eb8546c0ba46d6736847a4767b7e8c017a0e282
    command: bash -c "sleep infinity"
    volumes: *default-volumes

